import os

from flask import Flask
from flask import Response
from flask import request
from flask import jsonify

from util import exploit_checker, email_valid_checker

app = Flask(__name__)


@app.route('/check')
def check_exploit() -> Response:
    query = request.args

    if 'email' not in query or not email_valid_checker.check_email_valid(query['email']):
        return jsonify({
            'status': 'failed',
            'message': 'Invalid email address provided!'
        })

    return jsonify({
        'status': 'success',
        'result': exploit_checker.check_exploit(query['email'])
    })


def __init_service() -> None:
    app.run(os.getenv('HOST'), os.getenv('PORT'), debug=False)
