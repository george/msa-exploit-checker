import os

from flask import Flask
from flask import Response
from flask import request
from flask import jsonify

from checker.util import email_valid_checker
from checker.util import exploit_checker

app = Flask(__name__)

@app.route('/exploit-check')
def check_exploit() -> Response:
    query = request.args

    if 'email' not in query or not email_valid_checker.check_email_valid(query['email']):
        return jsonify({
            'status': 'failed',
            'message': 'Invalid email address provided!'
        })

    return jsonify({
        'status': 'success',
        'result': exploit_checker.check_exploit(query['email'])
    })


def init_app():
    app.run(os.getenv('HOST'), os.getenv('PORT'), debug=False)
