import os
import discord

from discord.ext import commands

from checker.util import email_valid_checker
from checker.util import exploit_checker

intents = discord.Intents.default()
intents.message_content = True

client = commands.Bot(command_prefix='.', intents=intents)

@client.event
async def on_ready():
    print('Successfully logged into ' + client.user.name + '!')
    print(f'Loaded {len(await client.tree.sync())} commands!')

    await client.change_presence(activity=discord.Game(name='Checking for exploits on MSA accounts'))

@client.tree.command(name = 'check', description='Checks if the MSA exploit is active on an account')
async def handle_check(interaction: discord.Interaction, email:str):
    if not email_valid_checker.check_email_valid(email):
        await interaction.response.send_message('The provided email address isn\'t valid!')
    await interaction.response.send_message(f'The exploit was {"" if exploit_checker.check_exploit(email) else "not"} found on that account!')

def init_bot():
    client.run(os.getenv('BOT_TOKEN'))
